From 3230a47e7d29e0eeb812925f9015ab94164e0654 Mon Sep 17 00:00:00 2001
From: Stefano Gurrieri <stefano.gurrieri@roj.com>
Date: Mon, 13 Jun 2016 14:40:22 +0200
Subject: [PATCH] hdmi-patches

---
 drivers/video/fbdev/mxc/mxc_hdmi.c | 14 +++++++++-----
 1 file changed, 9 insertions(+), 5 deletions(-)

diff --git a/drivers/video/fbdev/mxc/mxc_hdmi.c b/drivers/video/fbdev/mxc/mxc_hdmi.c
index c1b5126..4345723 100644
--- a/drivers/video/fbdev/mxc/mxc_hdmi.c
+++ b/drivers/video/fbdev/mxc/mxc_hdmi.c
@@ -1260,8 +1260,8 @@ static void mxc_hdmi_phy_init(struct mxc_hdmi *hdmi)
 			|| (hdmi->blank != FB_BLANK_UNBLANK))
 		return;
 
-	if (!hdmi->hdmi_data.video_mode.mDVI)
-		hdmi_enable_overflow_interrupts();
+	//if (!hdmi->hdmi_data.video_mode.mDVI)
+	//	hdmi_enable_overflow_interrupts();
 
 	/*check csc whether needed activated in HDMI mode */
 	cscon = (isColorSpaceConversion(hdmi) &&
@@ -1278,6 +1278,9 @@ static void mxc_hdmi_phy_init(struct mxc_hdmi *hdmi)
 		hdmi_phy_configure(hdmi, 0, 8, cscon);
 	}
 
+    if (!hdmi->hdmi_data.video_mode.mDVI)
+    	hdmi_enable_overflow_interrupts();
+
 	hdmi->phy_enabled = true;
 }
 
@@ -1574,7 +1577,7 @@ static int mxc_edid_read_internal(struct mxc_hdmi *hdmi, unsigned char *edid,
 	memset(&fbi->monspecs, 0, sizeof(fbi->monspecs));
 	fb_edid_to_monspecs(edid, &fbi->monspecs);
 
-	if (extblknum) {
+	if (extblknum > 0) {
 		ret = mxc_edid_parse_ext_blk(edid + EDID_LENGTH,
 				cfg, &fbi->monspecs);
 		if (ret < 0)
@@ -1796,12 +1799,13 @@ static void mxc_hdmi_edid_rebuild_modelist(struct mxc_hdmi *hdmi)
 		/*
 		 * We might check here if mode is supported by HDMI.
 		 * We do not currently support interlaced modes.
-		 * And add CEA modes in the modelist.
 		 */
 		mode = &hdmi->fbi->monspecs.modedb[i];
 
 		if (!(mode->vmode & FB_VMODE_INTERLACED) &&
-				(mxc_edid_mode_to_vic(mode) != 0)) {
+				mode->xres <= 1920 &&
+				mode->yres <= 1080 &&
+				mode->flag & FB_MODE_IS_STANDARD) {
 
 			dev_dbg(&hdmi->pdev->dev, "Added mode %d:", i);
 			dev_dbg(&hdmi->pdev->dev,
-- 
1.9.1

